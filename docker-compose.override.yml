version: "3.4"

services:
  nginx:
    image: nginx-dev
    build: ./nginx
    networks:
      - data-modelling-storage-service_default

  api:
    build:
      target: development
    image: api-dev
    volumes:
      - ./api/src/:/code
#      - ../data-modelling-storage-service/gen/dmss_api:/dmss_api
      - ../data-modelling-storage-service:/data-modelling-storage-service
    environment:
      FLASK_DEBUG: 1
      ENVIRONMENT: local
      LOGGING_LEVEL: DEBUG
      MONGO_AZURE_URI: ${MONGO_AZURE_URI}
      AZURE_SUBSCRIPTION: "some"
      AZURE_RESOURCE_GROUP: "someother"
      AZURE_AUTH_LOCATION: "/var/opt/cred.azureauth"
      AZURE_CREDENTIAL_FILE: |
        {
          "asd": "123",
          "asd": "123"
        }
    depends_on:
      - web
    ports:
      - "5000:5000"
    networks:
      - data-modelling-storage-service_default
    external_links:
      - dmss
      - db

  web:
    build:
      target: development
      args:
        AUTH_ENABLED: 1
    image: web-dev
    stdin_open: true
    volumes:
      - ./web/app/src:/code/app/src
      - ./web/plugins:/code/plugins
    environment:
      - NODE_ENV=development
    ports:
      - "3000:3000"
    networks:
      - data-modelling-storage-service_default

networks:
  data-modelling-storage-service_default:
    external: true
